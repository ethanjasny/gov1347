#
# This is a Shiny web application. You can run the application by clicking
# the 'Run App' button above.
#
# Find out more about building applications with Shiny here:
#
#    http://shiny.rstudio.com/
#

library(shiny)
library(tidyverse)
library(ggplot2)
library(usmap)
library(sf)
library(plotly)

consolidated_draws1 <- read.csv("./data/consolidated_draws1.csv")
consolidated_draws1 <- consolidated_draws1[,2:436]
merge_point <- read.csv("./data/merge_point.csv")
plot_list = list()

for (i in 1:435) {
  p <- plot_ly(x = consolidated_draws1[,i], type = "histogram", marker = list(color = 'blue', opacity = 0.5), name = "Simulated Dem Two-Party Vote Share") %>% 
    add_histogram(x = 100 - consolidated_draws1[,i], marker = list(color = 'red', opacity = 0.5), name = "Simulated Rep Two-Party Vote Share") %>%
    layout(legend = list(orientation = "h")) %>% 
    layout(barmode = "overlay") %>%
    layout(title = paste(merge_point$District[i], ": The Democrat wins ", merge_point$con_prob_dem_win[i],"% of 10,000 simulations", sep = ""),
           yaxis = list(title = '# of Simulations'), xaxis = list(range = c(0,100)))
  plot_list[[i]] = p
}


ui <- shinyUI(
  fluidPage(
    selectInput("selectPlot", "Select District:", merge_point$districtlabs),
    plotlyOutput("plot")
  )
)

server <- shinyServer(function(input,output,session){   
  
  data <- eventReactive(input$selectPlot,{
    switch(input$selectPlot,
           "AL01" = plot_list[[1]],
           "AL02" = plot_list[[2]],
           "AL03" = plot_list[[3]],
           "AL04" = plot_list[[4]],
           "AL05" = plot_list[[5]],
           "AL06" = plot_list[[6]],
           "AL07" = plot_list[[7]],
           "AK01" = plot_list[[8]],
           "AZ01" = plot_list[[9]],
           "AZ02" = plot_list[[10]],
           "AZ03" = plot_list[[11]],
           "AZ04" = plot_list[[12]],
           "AZ05" = plot_list[[13]],
           "AZ06" = plot_list[[14]],
           "AZ07" = plot_list[[15]],
           "AZ08" = plot_list[[16]],
           "AZ09" = plot_list[[17]],
           "AR01" = plot_list[[18]],
           "AR02" = plot_list[[19]],
           "AR03" = plot_list[[20]],
           "AR04" = plot_list[[21]],
           "CA01" = plot_list[[22]],
           "CA02" = plot_list[[23]],
           "CA03" = plot_list[[24]],
           "CA04" = plot_list[[25]],
           "CA05" = plot_list[[26]],
           "CA06" = plot_list[[27]],
           "CA07" = plot_list[[28]],
           "CA08" = plot_list[[29]],
           "CA09" = plot_list[[30]],
           "CA10" = plot_list[[31]],
           "CA11" = plot_list[[32]],
           "CA12" = plot_list[[33]],
           "CA13" = plot_list[[34]],
           "CA14" = plot_list[[35]],
           "CA15" = plot_list[[36]],
           "CA16" = plot_list[[37]],
           "CA17" = plot_list[[38]],
           "CA18" = plot_list[[39]],
           "CA19" = plot_list[[40]],
           "CA20" = plot_list[[41]],
           "CA21" = plot_list[[42]],
           "CA22" = plot_list[[43]],
           "CA23" = plot_list[[44]],
           "CA24" = plot_list[[45]],
           "CA25" = plot_list[[46]],
           "CA26" = plot_list[[47]],
           "CA27" = plot_list[[48]],
           "CA28" = plot_list[[49]],
           "CA29" = plot_list[[50]],
           "CA30" = plot_list[[51]],
           "CA31" = plot_list[[52]],
           "CA32" = plot_list[[53]],
           "CA33" = plot_list[[54]],
           "CA34" = plot_list[[55]],
           "CA35" = plot_list[[56]],
           "CA36" = plot_list[[57]],
           "CA37" = plot_list[[58]],
           "CA38" = plot_list[[59]],
           "CA39" = plot_list[[60]],
           "CA40" = plot_list[[61]],
           "CA41" = plot_list[[62]],
           "CA42" = plot_list[[63]],
           "CA43" = plot_list[[64]],
           "CA44" = plot_list[[65]],
           "CA45" = plot_list[[66]],
           "CA46" = plot_list[[67]],
           "CA47" = plot_list[[68]],
           "CA48" = plot_list[[69]],
           "CA49" = plot_list[[70]],
           "CA50" = plot_list[[71]],
           "CA51" = plot_list[[72]],
           "CA52" = plot_list[[73]],
           "CO01" = plot_list[[74]],
           "CO02" = plot_list[[75]],
           "CO03" = plot_list[[76]],
           "CO04" = plot_list[[77]],
           "CO05" = plot_list[[78]],
           "CO06" = plot_list[[79]],
           "CO07" = plot_list[[80]],
           "CO08" = plot_list[[81]],
           "CT01" = plot_list[[82]],
           "CT02" = plot_list[[83]],
           "CT03" = plot_list[[84]],
           "CT04" = plot_list[[85]],
           "CT05" = plot_list[[86]],
           "DE01" = plot_list[[87]],
           "FL01" = plot_list[[88]],
           "FL02" = plot_list[[89]],
           "FL03" = plot_list[[90]],
           "FL04" = plot_list[[91]],
           "FL05" = plot_list[[92]],
           "Fl06" = plot_list[[93]],
           "FL07" = plot_list[[94]],
           "FL08" = plot_list[[95]],
           "FL09" = plot_list[[96]],
           "FL10" = plot_list[[97]],
           "FL11" = plot_list[[98]],
           "FL12" = plot_list[[99]],
           "FL13" = plot_list[[100]],
           "FL14" = plot_list[[101]],
           "FL15" = plot_list[[102]],
           "FL16" = plot_list[[103]],
           "FL17" = plot_list[[104]],
           "FL18" = plot_list[[105]],
           "FL19" = plot_list[[106]],
           "FL20" = plot_list[[107]],
           "FL21" = plot_list[[108]],
           "FL22" = plot_list[[109]],
           "FL23" = plot_list[[110]],
           "FL24" = plot_list[[111]],
           "FL25" = plot_list[[112]],
           "FL26" = plot_list[[113]],
           "FL27" = plot_list[[114]],
           "FL28" = plot_list[[115]],
           "GA01" = plot_list[[116]],
           "GA02" = plot_list[[117]],
           "GA03" = plot_list[[118]],
           "GA04" = plot_list[[119]],
           "GA05" = plot_list[[120]],
           "GA06" = plot_list[[121]],
           "GA07" = plot_list[[122]],
           "GA08" = plot_list[[123]],
           "GA09" = plot_list[[124]],
           "GA10" = plot_list[[125]],
           "GA11" = plot_list[[126]],
           "GA12" = plot_list[[127]],
           "GA13" = plot_list[[128]],
           "GA14" = plot_list[[129]],
           "HI01" = plot_list[[130]],
           "HI02" = plot_list[[131]],
           "ID01" = plot_list[[132]],
           "ID02" = plot_list[[133]],
           "IL01" = plot_list[[134]],
           "IL02" = plot_list[[135]],
           "IL03" = plot_list[[136]],
           "IL04" = plot_list[[137]],
           "IL05" = plot_list[[138]],
           "IL06" = plot_list[[139]],
           "IL07" = plot_list[[140]],
           "IL08" = plot_list[[141]],
           "IL09" = plot_list[[142]],
           "IL10" = plot_list[[143]],
           "IL11" = plot_list[[144]],
           "IL12" = plot_list[[145]],
           "IL13" = plot_list[[146]],
           "IL14" = plot_list[[147]],
           "IL15" = plot_list[[148]],
           "IL16" = plot_list[[149]],
           "IL17" = plot_list[[150]],
           "IN01" = plot_list[[151]],
           "IN02" = plot_list[[152]],
           "IN03" = plot_list[[153]],
           "IN04" = plot_list[[154]],
           "IN05" = plot_list[[155]],
           "IN06" = plot_list[[156]],
           "IN07" = plot_list[[157]],
           "IN08" = plot_list[[158]],
           "IN09" = plot_list[[159]],
           "IA01" = plot_list[[160]],
           "IA02" = plot_list[[161]],
           "IA03" = plot_list[[162]],
           "IA04" = plot_list[[163]],
           "KS01" = plot_list[[164]],
           "KS02" = plot_list[[165]],
           "KS03" = plot_list[[166]],
           "KS04" = plot_list[[167]],
           "KY01" = plot_list[[168]],
           "KY02" = plot_list[[169]],
           "KY03" = plot_list[[170]],
           "KY04" = plot_list[[171]],
           "KY05" = plot_list[[172]],
           "KY06" = plot_list[[173]],
           "LA01" = plot_list[[174]],
           "LA02" = plot_list[[175]],
           "LA03" = plot_list[[176]],
           "LA04" = plot_list[[177]],
           "LA05" = plot_list[[178]],
           "LA06" = plot_list[[179]],
           "ME01" = plot_list[[180]],
           "ME02" = plot_list[[181]],
           "MD01" = plot_list[[182]],
           "MD02" = plot_list[[183]],
           "MD03" = plot_list[[184]],
           "MD04" = plot_list[[185]],
           "MD05" = plot_list[[186]],
           "MD06" = plot_list[[187]],
           "MD07" = plot_list[[188]],
           "MD08" = plot_list[[189]],
           "MA01" = plot_list[[190]],
           "MA02" = plot_list[[191]],
           "MA03" = plot_list[[192]],
           "MA04" = plot_list[[193]],
           "MA05" = plot_list[[194]],
           "MA06" = plot_list[[195]],
           "MA07" = plot_list[[196]],
           "MA08" = plot_list[[197]],
           "MA09" = plot_list[[198]],
           "MI01" = plot_list[[199]],
           "MI02" = plot_list[[200]],
           "MI03" = plot_list[[201]],
           "MI04" = plot_list[[202]],
           "MI05" = plot_list[[203]],
           "MI06" = plot_list[[204]],
           "MI07" = plot_list[[205]],
           "MI08" = plot_list[[206]],
           "MI09" = plot_list[[207]],
           "MI10" = plot_list[[208]],
           "MI11" = plot_list[[209]],
           "MI12" = plot_list[[210]],
           "MI13" = plot_list[[211]],
           "MN01" = plot_list[[212]],
           "MN02" = plot_list[[213]],
           "MN03" = plot_list[[214]],
           "MN04" = plot_list[[215]],
           "MN05" = plot_list[[216]],
           "MN06" = plot_list[[217]],
           "MN07" = plot_list[[218]],
           "MN08" = plot_list[[219]],
           "MS01" = plot_list[[220]],
           "MS02" = plot_list[[221]],
           "MS03" = plot_list[[222]],
           "MS04" = plot_list[[223]],
           "MO01" = plot_list[[224]],
           "MO02" = plot_list[[225]],
           "MO03" = plot_list[[226]],
           "MO04" = plot_list[[227]],
           "MO05" = plot_list[[228]],
           "MO06" = plot_list[[229]],
           "MO07" = plot_list[[230]],
           "MO08" = plot_list[[231]],
           "MT01" = plot_list[[232]],
           "MT02" = plot_list[[233]],
           "NE01" = plot_list[[234]],
           "NE02" = plot_list[[235]],
           "NE03" = plot_list[[236]],
           "NV01" = plot_list[[237]],
           "NV02" = plot_list[[238]],
           "NV03" = plot_list[[239]],
           "NV04" = plot_list[[240]],
           "NH01" = plot_list[[241]],
           "NH02" = plot_list[[242]],
           "NJ01" = plot_list[[243]],
           "NJ02" = plot_list[[244]],
           "NJ03" = plot_list[[245]],
           "NJ04" = plot_list[[246]],
           "NJ05" = plot_list[[247]],
           "NJ06" = plot_list[[248]],
           "NJ07" = plot_list[[249]],
           "NJ08" = plot_list[[250]],
           "NJ09" = plot_list[[251]],
           "NJ10" = plot_list[[252]],
           "NJ11" = plot_list[[253]],
           "NJ12" = plot_list[[254]],
           "NM01" = plot_list[[255]],
           "NM02" = plot_list[[256]],
           "NM03" = plot_list[[257]],
           "NY01" = plot_list[[258]],
           "NY02" = plot_list[[259]],
           "NY03" = plot_list[[260]],
           "NY04" = plot_list[[261]],
           "NY05" = plot_list[[262]],
           "NY06" = plot_list[[263]],
           "NY07" = plot_list[[264]],
           "NY08" = plot_list[[265]],
           "NY09" = plot_list[[266]],
           "NY10" = plot_list[[267]],
           "NY11" = plot_list[[268]],
           "NY12" = plot_list[[269]],
           "NY13" = plot_list[[270]],
           "NY14" = plot_list[[271]],
           "NY15" = plot_list[[272]],
           "NY16" = plot_list[[273]],
           "NY17" = plot_list[[274]],
           "NY18" = plot_list[[275]],
           "NY19" = plot_list[[276]],
           "NY20" = plot_list[[277]],
           "NY21" = plot_list[[278]],
           "NY22" = plot_list[[279]],
           "NY23" = plot_list[[280]],
           "NY24" = plot_list[[281]],
           "NY25" = plot_list[[282]],
           "NY26" = plot_list[[283]],
           "NC01" = plot_list[[284]],
           "NC02" = plot_list[[285]],
           "NC03" = plot_list[[286]],
           "NC04" = plot_list[[287]],
           "NC05" = plot_list[[288]],
           "NC06" = plot_list[[289]],
           "NC07" = plot_list[[290]],
           "NC08" = plot_list[[291]],
           "NC09" = plot_list[[292]],
           "NC10" = plot_list[[293]],
           "NC11" = plot_list[[294]],
           "NC12" = plot_list[[295]],
           "NC13" = plot_list[[296]],
           "NC14" = plot_list[[297]],
           "ND01" = plot_list[[298]],
           "OH01" = plot_list[[299]],
           "OH02" = plot_list[[300]],
           "OH03" = plot_list[[301]],
           "OH04" = plot_list[[302]],
           "OH05" = plot_list[[303]],
           "OH06" = plot_list[[304]],
           "OH07" = plot_list[[305]],
           "OH08" = plot_list[[306]],
           "OH09" = plot_list[[307]],
           "OH10" = plot_list[[308]],
           "OH11" = plot_list[[309]],
           "OH12" = plot_list[[310]],
           "OH13" = plot_list[[311]],
           "OH14" = plot_list[[312]],
           "OH15" = plot_list[[313]],
           "OK01" = plot_list[[314]],
           "OK02" = plot_list[[315]],
           "OK03" = plot_list[[316]],
           "OK04" = plot_list[[317]],
           "OK05" = plot_list[[318]],
           "OR01" = plot_list[[319]],
           "OR02" = plot_list[[320]],
           "OR03" = plot_list[[321]],
           "OR04" = plot_list[[322]],
           "OR05" = plot_list[[323]],
           "OR06" = plot_list[[324]],
           "PA01" = plot_list[[325]],
           "PA02" = plot_list[[326]],
           "PA03" = plot_list[[327]],
           "PA04" = plot_list[[328]],
           "PA05" = plot_list[[329]],
           "PA06" = plot_list[[330]],
           "PA07" = plot_list[[331]],
           "PA08" = plot_list[[332]],
           "PA09" = plot_list[[333]],
           "PA10" = plot_list[[334]],
           "PA11" = plot_list[[335]],
           "PA12" = plot_list[[336]],
           "PA13" = plot_list[[337]],
           "PA14" = plot_list[[338]],
           "PA15" = plot_list[[339]],
           "PA16" = plot_list[[340]],
           "PA17" = plot_list[[341]],
           "RI01" = plot_list[[342]],
           "RI02" = plot_list[[343]],
           "SC01" = plot_list[[344]],
           "SC02" = plot_list[[345]],
           "SC03" = plot_list[[346]],
           "SC04" = plot_list[[347]],
           "SC05" = plot_list[[348]],
           "SC06" = plot_list[[349]],
           "SC07" = plot_list[[350]],
           "SD01" = plot_list[[351]],
           "TN01" = plot_list[[352]],
           "TN02" = plot_list[[353]],
           "TN03" = plot_list[[354]],
           "TN04" = plot_list[[355]],
           "TN05" = plot_list[[356]],
           "TN06" = plot_list[[357]],
           "TN07" = plot_list[[358]],
           "TN08" = plot_list[[359]],
           "TN09" = plot_list[[360]],
           "TX01" = plot_list[[361]],
           "TX02" = plot_list[[362]],
           "TX03" = plot_list[[363]],
           "TX04" = plot_list[[364]],
           "TX05" = plot_list[[365]],
           "TX06" = plot_list[[366]],
           "TX07" = plot_list[[367]],
           "TX08" = plot_list[[368]],
           "TX09" = plot_list[[369]],
           "TX10" = plot_list[[370]],
           "TX11" = plot_list[[371]],
           "TX12" = plot_list[[372]],
           "TX13" = plot_list[[373]],
           "TX14" = plot_list[[374]],
           "TX15" = plot_list[[375]],
           "TX16" = plot_list[[376]],
           "TX17" = plot_list[[377]],
           "TX18" = plot_list[[378]],
           "TX19" = plot_list[[379]],
           "TX20" = plot_list[[380]],
           "TX21" = plot_list[[381]],
           "TX22" = plot_list[[382]],
           "TX23" = plot_list[[383]],
           "TX24" = plot_list[[384]],
           "TX25" = plot_list[[385]],
           "TX26" = plot_list[[386]],
           "TX27" = plot_list[[387]],
           "TX28" = plot_list[[388]],
           "TX29" = plot_list[[389]],
           "TX30" = plot_list[[390]],
           "TX31" = plot_list[[391]],
           "TX32" = plot_list[[392]],
           "TX33" = plot_list[[393]],
           "TX34" = plot_list[[394]],
           "TX35" = plot_list[[395]],
           "TX36" = plot_list[[396]],
           "TX37" = plot_list[[397]],
           "TX38" = plot_list[[398]],
           "UT01" = plot_list[[399]],
           "UT02" = plot_list[[400]],
           "UT03" = plot_list[[401]],
           "UT04" = plot_list[[402]],
           "VT01" = plot_list[[403]],
           "VA01" = plot_list[[404]],
           "VA02" = plot_list[[405]],
           "VA03" = plot_list[[406]],
           "VA04" = plot_list[[407]],
           "VA05" = plot_list[[408]],
           "VA06" = plot_list[[409]],
           "VA07" = plot_list[[410]],
           "VA08" = plot_list[[411]],
           "VA09" = plot_list[[412]],
           "VA10" = plot_list[[413]],
           "VA11" = plot_list[[414]],
           "WA01" = plot_list[[415]],
           "WA02" = plot_list[[416]],
           "WA03" = plot_list[[417]],
           "WA04" = plot_list[[418]],
           "WA05" = plot_list[[419]],
           "WA06" = plot_list[[420]],
           "WA07" = plot_list[[421]],
           "WA08" = plot_list[[422]],
           "WA09" = plot_list[[423]],
           "WA10" = plot_list[[424]],
           "WV01" = plot_list[[425]],
           "WV02" = plot_list[[426]],
           "WI01" = plot_list[[427]],
           "WI02" = plot_list[[428]],
           "WI03" = plot_list[[429]],
           "WI04" = plot_list[[430]],
           "WI05" = plot_list[[431]],
           "WI06" = plot_list[[432]],
           "WI07" = plot_list[[433]],
           "WI08" = plot_list[[434]],
           "WY01" = plot_list[[435]])
  })
  
  output$plot <- renderPlotly({
    data()
  })
})
# Run the application 
shinyApp(ui = ui, server = server)
